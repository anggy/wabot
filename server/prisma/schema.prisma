generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Session {
  id        String   @id
  name      String
  status    String   @default("DISCONNECTED")
  config    String?
  userId    Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model Rule {
  id                Int      @id @default(autoincrement())
  name              String
  triggerType       String
  triggerValue      String
  actionType        String
  apiUrl            String?
  apiMethod         String?  @default("POST")
  apiPayload        String?
  responseContent   String?
  responseMediaType String?  @default("TEXT")
  responseMediaUrl  String?
  isActive          Boolean  @default(true)
  sessionId         String?  // Optional, if null it applies to all sessions
  userId            Int      @default(1)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id])
}

model Schedule {
  id             Int       @id @default(autoincrement())
  sessionId      String
  recipient      String
  messageType    String
  content        String
  mediaUrl       String?
  cronExpression String
  lastRun        DateTime?
  isActive       Boolean   @default(true)
  userId         Int       @default(1)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  user           User      @relation(fields: [userId], references: [id])
}

model MessageLog {
  id        Int      @id @default(autoincrement())
  sessionId String
  direction String
  from      String
  to        String
  content   String
  status    String
  createdAt DateTime @default(now())
}

model Contact {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String   @unique
  tags      String?
  userId    Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model User {
  id            Int        @id @default(autoincrement())
  username      String     @unique
  email         String?
  phone         String?
  password      String
  role          String     @default("USER")
  credits       Int        @default(0)
  planType      String     @default("PAY_AS_YOU_GO")
  planExpiresAt DateTime?
  messageCost   Int        @default(1)
  aiApiKey      String?
  aiBriefing    String?
  isAiEnabled   Boolean    @default(false)
  isActive      Boolean    @default(true)
  createdAt     DateTime   @default(now())
  contacts      Contact[]
  rules         Rule[]
  schedules     Schedule[]
  sessions      Session[]
}
